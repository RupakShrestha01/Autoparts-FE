(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[441],{840:function(e,r,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/order/[id]",function(){return s(2396)}])},8662:function(e,r,s){"use strict";s.d(r,{Z:function(){return g}});var t=s(5893),n=s(3299),a=s(9008),i=s.n(a),c=s(1664),d=s.n(c),l=s(1955),o=s(7294),u=s(2920),h=s(6272),x=(s(993),s(8766)),p=s(1799),m=s(9396),v=s(9534);function j(e){var r=e.href,s=e.children,n=(0,v.Z)(e,["href","children"]);return(0,t.jsx)(d(),{href:r,children:(0,t.jsx)("a",(0,m.Z)((0,p.Z)({},n),{children:s}))})}var f=s(1163),y=s(3737);function g(e){var r=e.title,s=e.children,a=(0,n.useSession)(),c=a.status,p=a.data,m=(0,o.useContext)(x.y),v=m.state,g=m.dispatch,b=v.cart,N=(0,o.useState)(0),E=N[0],w=N[1];(0,o.useEffect)((function(){w(b.cartItems.reduce((function(e,r){return e+r.quantity}),0))}),[b.cartItems]);var S=(0,o.useState)(""),_=S[0],Z=S[1],A=(0,f.useRouter)();return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(i(),{children:[(0,t.jsx)("title",{children:r?r+" - Autoparts":"Autoparts"}),(0,t.jsx)("meta",{name:"description",content:"Ecommerce Website"}),(0,t.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,t.jsx)(u.Ix,{position:"bottom-center",limit:1}),(0,t.jsxs)("div",{className:"flex min-h-screen flex-col justify-between sticky ",children:[(0,t.jsx)("header",{className:"",children:(0,t.jsxs)("nav",{className:"flex h-12 items-center px-4 justify-between shadow-md",children:[(0,t.jsx)(d(),{href:"/",children:(0,t.jsx)("a",{className:"text-lg font-bold",children:"Autoparts"})}),(0,t.jsxs)("form",{onSubmit:function(e){e.preventDefault(),A.push("/search?query=".concat(_))},className:"mx-auto hidden justify-center md:flex",children:[(0,t.jsx)("input",{onChange:function(e){return Z(e.target.value)},type:"text",className:"rounded-tr-none rounded-br-none p-1 text-sm focus:ring-0",placeholder:"Search products"}),(0,t.jsx)("button",{className:"rounded rounded-tl-none rounded-bl-none bg-amber-300 p-1 text-sm dark:text-black",type:"submit",id:"button-addon2",children:(0,t.jsx)(y.Z,{className:"h-5 w-5"})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(d(),{href:"/cart",children:(0,t.jsxs)("a",{className:"p-2",children:["Cart",E>0&&(0,t.jsx)("span",{className:"ml-1 rounded-full bg-red-600 px-2 py-1 text-xs font-bold text-white",children:E})]})}),"loading"===c?"Loading":(null===p||void 0===p?void 0:p.user)?(0,t.jsxs)(h.v,{as:"div",className:"relative inline-block ",children:[(0,t.jsx)(h.v.Button,{className:"text-blue-600 ",children:p.user.name}),(0,t.jsxs)(h.v.Items,{className:"absolute right-0 w-56 origin-top-right bg-gray-400 shadow-lg ",children:[(0,t.jsx)(h.v.Item,{children:(0,t.jsx)(j,{className:"dropdown-link hover:text-white",href:"/profile",children:"Profile"})}),(0,t.jsx)(h.v.Item,{children:(0,t.jsx)(j,{className:"dropdown-link hover:text-white",href:"/order-history",children:"Order History"})}),p.user.isAdmin&&(0,t.jsx)(h.v.Item,{children:(0,t.jsx)(j,{className:"dropdown-link hover:text-white",href:"/admin/dashboard",children:"Admin Dashboard"})}),(0,t.jsx)(h.v.Item,{children:(0,t.jsx)("a",{className:"dropdown-link hover:text-white",href:"#",onClick:function(){l.Z.remove("cart"),g({type:"CART_RESET"}),(0,n.signOut)({callbackUrl:"/login"})},children:"Logout"})})]})]}):(0,t.jsx)(d(),{href:"/login",children:(0,t.jsx)("a",{className:"p-2",children:"Login"})})]})]})}),(0,t.jsx)("main",{className:"container m-auto mt-4 px-4",children:s}),(0,t.jsx)("footer",{className:"flex h-10 justify-center items-center shadow-inner",children:(0,t.jsx)("p",{children:"Copyright \xa9 2022 Autoparts"})})]})]})}},2396:function(e,r,s){"use strict";s.r(r),s.d(r,{default:function(){return _}});var t=s(7568),n=s(1799),a=s(9396);var i=s(3375);var c=s(1566);function d(e,r){return function(e){if(Array.isArray(e))return e}(e)||(0,i.Z)(e,r)||(0,c.Z)(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var l=s(4051),o=s.n(l),u=s(5893),h=s(8945),x=s(3299),p=s(5021),m=s(5675),v=s.n(m),j=s(1664),f=s.n(j),y=s(1163),g=s(2920),b=s(7294),N=s(8662),E=s(3250);function w(e,r){switch(r.type){case"FETCH_REQUEST":return(0,a.Z)((0,n.Z)({},e),{loading:!0,error:""});case"FETCH_SUCCESS":return(0,a.Z)((0,n.Z)({},e),{loading:!1,order:r.payload,error:""});case"FETCH_FAIL":return(0,a.Z)((0,n.Z)({},e),{loading:!1,error:r.payload});case"PAY_REQUEST":return(0,a.Z)((0,n.Z)({},e),{loadingPay:!0});case"PAY_SUCCESS":return(0,a.Z)((0,n.Z)({},e),{loadingPay:!1,successPay:!0});case"PAY_FAIL":return(0,a.Z)((0,n.Z)({},e),{loadingPay:!1,errorPay:r.payload});case"PAY_RESET":return(0,a.Z)((0,n.Z)({},e),{loadingPay:!1,successPay:!1,errorPay:""});case"DELIVER_REQUEST":return(0,a.Z)((0,n.Z)({},e),{loadingDeliver:!0});case"DELIVER_SUCCESS":return(0,a.Z)((0,n.Z)({},e),{loadingDeliver:!1,successDeliver:!0});case"DELIVER_FAIL":return(0,a.Z)((0,n.Z)({},e),{loadingDeliver:!1});case"DELIVER_RESET":return(0,a.Z)((0,n.Z)({},e),{loadingDeliver:!1,successDeliver:!1})}}function S(){var e=(0,x.useSession)().data,r=d((0,p.Up)(),2),s=r[0].isPending,n=r[1],a=(0,y.useRouter)().query.id,i=(0,b.useReducer)(w,{loading:!0,order:{},error:""}),c=i[0],l=c.loading,m=c.error,j=c.order,S=c.successPay,_=c.loadingPay,Z=c.loadingDeliver,A=c.successDeliver,P=i[1];(0,b.useEffect)((function(){var e=function(){var e=(0,t.Z)(o().mark((function e(){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,P({type:"FETCH_REQUEST"}),e.next=4,h.Z.get("/api/orders/".concat(a));case 4:r=e.sent.data,P({type:"FETCH_SUCCESS",payload:r}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),P({type:"FETCH_FAIL",payload:(0,E.b)(e.t0)});case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();if(!j._id||S||A||j._id&&j._id!==a)e(),S&&P({type:"PAY_RESET"}),A&&P({type:"DELIVER_RESET"});else{var r=function(){var e=(0,t.Z)(o().mark((function e(){var r,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.Z.get("/api/keys/paypal");case 2:r=e.sent,s=r.data,n({type:"resetOptions",value:{"client-id":s,currency:"USD"}}),n({type:"setLoadingStatus",value:"pending"});case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();r()}}),[j,a,n,A,S]);var C=j.shippingAddress,I=j.paymentMethod,k=j.orderItems,D=j.itemsPrice,R=j.taxPrice,T=j.shippingPrice,L=j.totalPrice,U=j.isPaid,F=j.paidAt,O=j.isDelivered,V=j.deliveredAt;function Y(){return(Y=(0,t.Z)(o().mark((function e(){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,P({type:"DELIVER_REQUEST"}),e.next=4,h.Z.put("/api/admin/orders/".concat(j._id,"/deliver"),{});case 4:r=e.sent.data,P({type:"DELIVER_SUCCESS",payload:r}),g.Am.success("Order is delivered"),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),P({type:"DELIVER_FAIL",payload:(0,E.b)(e.t0)}),g.Am.error((0,E.b)(e.t0));case 13:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}return(0,u.jsxs)(N.Z,{title:"Order ".concat(a),children:[(0,u.jsx)("h1",{className:"mb-4 text-xl",children:"Order ".concat(a)}),l?(0,u.jsx)("div",{children:"Loading..."}):m?(0,u.jsx)("div",{className:"alert-error",children:m}):(0,u.jsxs)("div",{className:"grid md:grid-cols-4 md:gap-5",children:[(0,u.jsxs)("div",{className:"overflow-x-auto md:col-span-3",children:[(0,u.jsxs)("div",{className:"card p-5",children:[(0,u.jsx)("h2",{className:"mb-2 text-lg",children:"Shipping Address"}),(0,u.jsxs)("div",{children:[C.fullName,", ",C.address,","," ",C.city,", ",C.postalCode,","," ",C.country]}),O?(0,u.jsxs)("div",{className:"alert-success",children:["Delivered at ",V]}):(0,u.jsx)("div",{className:"alert-error",children:"Not delivered"})]}),(0,u.jsxs)("div",{className:"card p-5",children:[(0,u.jsx)("h2",{className:"mb-2 text-lg",children:"Payment Method"}),(0,u.jsx)("div",{children:I}),U?(0,u.jsxs)("div",{className:"alert-success",children:["Paid at ",F]}):(0,u.jsx)("div",{className:"alert-error",children:"Not paid"})]}),(0,u.jsxs)("div",{className:"card overflow-x-auto p-5",children:[(0,u.jsx)("h2",{className:"mb-2 text-lg",children:"Order Items"}),(0,u.jsxs)("table",{className:"min-w-full",children:[(0,u.jsx)("thead",{className:"border-b",children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{className:"px-5 text-left",children:"Item"}),(0,u.jsx)("th",{className:" p-5 text-right",children:"Quantity"}),(0,u.jsx)("th",{className:" p-5 text-right",children:"Price"}),(0,u.jsx)("th",{className:"p-5 text-right",children:"Subtotal"})]})}),(0,u.jsx)("tbody",{children:k.map((function(e){return(0,u.jsxs)("tr",{className:"border-b",children:[(0,u.jsx)("td",{children:(0,u.jsx)(f(),{href:"/product/".concat(e.slug),children:(0,u.jsxs)("a",{className:"flex items-center",children:[(0,u.jsx)(v(),{src:e.image,alt:e.name,width:50,height:50}),"\xa0",e.name]})})}),(0,u.jsx)("td",{className:" p-5 text-right",children:e.quantity}),(0,u.jsxs)("td",{className:"p-5 text-right",children:["$",e.price]}),(0,u.jsxs)("td",{className:"p-5 text-right",children:["$",e.quantity*e.price]})]},e._id)}))})]})]})]}),(0,u.jsx)("div",{children:(0,u.jsxs)("div",{className:"card p-5",children:[(0,u.jsx)("h2",{className:"mb-2 text-lg",children:"Order Summary"}),(0,u.jsxs)("ul",{children:[(0,u.jsx)("li",{children:(0,u.jsxs)("div",{className:"mb-2 flex justify-between",children:[(0,u.jsx)("div",{children:"Items"}),(0,u.jsxs)("div",{children:["$",D]})]})})," ",(0,u.jsx)("li",{children:(0,u.jsxs)("div",{className:"mb-2 flex justify-between",children:[(0,u.jsx)("div",{children:"Tax"}),(0,u.jsxs)("div",{children:["$",R]})]})}),(0,u.jsx)("li",{children:(0,u.jsxs)("div",{className:"mb-2 flex justify-between",children:[(0,u.jsx)("div",{children:"Shipping"}),(0,u.jsxs)("div",{children:["$",T]})]})}),(0,u.jsx)("li",{children:(0,u.jsxs)("div",{className:"mb-2 flex justify-between",children:[(0,u.jsx)("div",{children:"Total"}),(0,u.jsxs)("div",{children:["$",L]})]})}),!U&&(0,u.jsxs)("li",{children:[s?(0,u.jsx)("div",{children:"Loading..."}):(0,u.jsx)("div",{className:"w-full",children:(0,u.jsx)(p.ch,{createOrder:function(e,r){return r.order.create({purchase_units:[{amount:{value:L}}]}).then((function(e){return e}))},onApprove:function(e,r){return r.order.capture().then(function(){var e=(0,t.Z)(o().mark((function e(r){var s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,P({type:"PAY_REQUEST"}),e.next=4,h.Z.put("/api/orders/".concat(j._id,"/pay"),r);case 4:s=e.sent.data,P({type:"PAY_SUCCESS",payload:s}),g.Am.success("Order is paid successgully"),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),P({type:"PAY_FAIL",payload:(0,E.b)(e.t0)}),g.Am.error((0,E.b)(e.t0));case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(r){return e.apply(this,arguments)}}())},onError:function(e){g.Am.error((0,E.b)(e))}})}),_&&(0,u.jsx)("div",{children:"Loading..."})]}),e.user.isAdmin&&j.isPaid&&!j.isDelivered&&(0,u.jsxs)("li",{children:[Z&&(0,u.jsx)("div",{children:"Loading..."}),(0,u.jsx)("button",{className:"primary-button w-full",onClick:function(){return Y.apply(this,arguments)},children:"Deliver Order"})]})]})]})})]})]})}S.auth=!0;var _=S},3250:function(e,r,s){"use strict";s.d(r,{b:function(){return t}});var t=function(e){return e.response&&e.response.data&&e.response.data.message?e.response.data.message:e.message}}},function(e){e.O(0,[956,540,675,774,888,179],(function(){return r=840,e(e.s=r);var r}));var r=e.O();_N_E=r}]);